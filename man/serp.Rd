% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/sort.R
\name{serp}
\alias{serp}
\title{Serpentine Sorting for Implicit Stratification}
\usage{
serp(...)
}
\arguments{
\item{...}{Columns to sort by, in hierarchical order (e.g., region, district,
commune). Used inside \code{\link[dplyr:arrange]{dplyr::arrange()}}, similar to \code{\link[dplyr:desc]{dplyr::desc()}}.}
}
\value{
A numeric vector (sort key) for use by \code{\link[dplyr:arrange]{dplyr::arrange()}}.
}
\description{
\code{serp()} implements hierarchic serpentine sorting (also called "snake" sorting),
transforming a multi-dimensional hierarchy into a one-dimensional path that
preserves spatial contiguity. This is the algorithm used by SAS PROC SURVEYSELECT
with \code{SORT=SERP}.

Serpentine sorting alternates direction at each hierarchy level:
\itemize{
\item First variable: ascending
\item Second variable: ascending in odd groups of first, descending in even groups
\item Third variable: alternates based on combined grouping of first two
\item And so on...
}

This provides implicit stratification when combined with systematic or sequential
sampling, ensuring samples spread evenly across geographic/administrative hierarchies.
}
\details{
\subsection{Algorithm}{

The algorithm builds a composite sort key by:
\enumerate{
\item Converting each variable to integer ranks
\item For variable i, determining group membership from variables 1..(i-1)
\item If the cumulative group number is even, flipping ranks (descending)
\item Using multi-column ordering to produce final sort positions
}
}

\subsection{Use with Systematic Sampling}{

Serpentine sorting is particularly effective with systematic sampling.
By ordering the frame in a snake-like pattern, a systematic sample
automatically spreads across all regions and sub-regions.
}

\subsection{Comparison with Nested Sorting}{

Standard sorting creates large "jumps" at hierarchy boundaries. Serpentine
sorting minimizes these by reversing direction -- the last district of region 1
is adjacent to the last district of region 2.
}
}
\examples{
library(dplyr)

# Basic serpentine sorting with mtcars
mtcars |>
  arrange(serp(cyl, gear, carb)) |>
  select(cyl, gear, carb) |>
  head(15)

# Compare nested vs serpentine sorting
# Nested: gear always ascending within cyl
mtcars |>
  arrange(cyl, gear) |>
  select(cyl, gear) |>
  head(12)

# Serpentine: gear direction alternates by cyl group
mtcars |>
  arrange(serp(cyl, gear)) |>
  select(cyl, gear) |>
  head(12)

# Implicit stratification with systematic sampling
# Sort Niger EAs in serpentine order, then draw systematic sample
sampling_design() |>
  draw(n = 100, method = "systematic") |>
  execute(arrange(niger_eas, serp(region, department)),
                  seed = 42)

# Combine explicit stratification with serpentine sorting
# Stratify by urban/rural, use serpentine within strata
sampling_design() |>
  stratify_by(strata) |>
  draw(n = 100, method = "systematic") |>
  execute(arrange(niger_eas, strata, serp(region, department)),
                  seed = 1234)

}
\references{
Chromy, J. R. (1979). Sequential sample selection methods.
\emph{Proceedings of the Survey Research Methods Section, ASA}, 401-406.

Williams, R. L., & Chromy, J. R. (1980). SAS sample selection macros.
\emph{Proceedings of the Fifth Annual SAS Users Group International}, 392-396.
}
\seealso{
\code{\link[dplyr:arrange]{dplyr::arrange()}}, \code{\link[dplyr:desc]{dplyr::desc()}}
}
