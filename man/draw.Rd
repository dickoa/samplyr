% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/draw.R
\name{draw}
\alias{draw}
\title{Specify Selection Parameters}
\usage{
draw(
  .data,
  n = NULL,
  frac = NULL,
  min_n = NULL,
  max_n = NULL,
  method = "srswor",
  mos = NULL,
  round = "up"
)
}
\arguments{
\item{.data}{A \code{sampling_design} object (piped from \code{\link[=sampling_design]{sampling_design()}},
\code{\link[=stratify_by]{stratify_by()}}, or \code{\link[=cluster_by]{cluster_by()}}).}

\item{n}{Sample size. Can be:
\itemize{
\item A scalar: applies per stratum (if no \code{alloc}) or as total (if \code{alloc} specified)
\item A named vector: stratum-specific sizes (for single stratification variable)
\item A data frame: stratum-specific sizes with stratification columns + \code{n} column
}}

\item{frac}{Sampling fraction. Can be:
\itemize{
\item A scalar: same fraction for all strata
\item A named vector: stratum-specific fractions
\item A data frame: stratum-specific fractions with stratification columns + \code{frac} column
Only one of \code{n} or \code{frac} should be specified.
}}

\item{min_n}{Minimum sample size per stratum. When an allocation method
(e.g., Neyman, proportional) would assign fewer than \code{min_n} units to a
stratum, that stratum receives \code{min_n} units instead. The excess is
redistributed proportionally among strata that were above \code{min_n}.
Commonly set to 2 (minimum for variance estimation) or higher for
reliable subgroup estimates. Only applies when stratification with an
allocation method is used. Default is \code{NULL} (no minimum).}

\item{max_n}{Maximum sample size per stratum. When an allocation method
would assign more than \code{max_n} units to a stratum, that stratum is
capped at \code{max_n} units. The surplus is redistributed proportionally
among strata that were below \code{max_n}. Useful for capping dominant strata
or managing operational constraints. Only applies when stratification
with an allocation method is used. Default is \code{NULL} (no maximum).}

\item{method}{Character string specifying the selection method. One of:

\strong{Equal probability methods:}
\itemize{
\item \code{"srswor"} (default): Simple random sampling without replacement
\item \code{"srswr"}: Simple random sampling with replacement
\item \code{"systematic"}: Systematic (fixed interval) sampling
\item \code{"bernoulli"}: Independent Bernoulli trials (random sample size)
}

\strong{PPS methods (require \code{mos}):}
\itemize{
\item \code{"pps_systematic"}: PPS systematic sampling
\item \code{"pps_brewer"}: Generalized Brewer (Tillé) method
\item \code{"pps_maxent"}: Maximum entropy / conditional Poisson
\item \code{"pps_poisson"}: PPS Poisson sampling (random sample size)
\item \code{"pps_multinomial"}: PPS multinomial (with replacement)
}}

\item{mos}{<\code{\link[dplyr:dplyr_data_masking]{data-masking}}> Measure of size
variable for PPS methods. Required for all \verb{pps_*} methods.}

\item{round}{Rounding method when converting \code{frac} to sample sizes.
One of:
\itemize{
\item \code{"up"} (default): Round up (ceiling). Matches SAS SURVEYSELECT default.
\item \code{"down"}: Round down (floor).
\item \code{"nearest"}: Round to nearest integer (standard rounding).
}

This parameter only affects designs using \code{frac} to specify the sampling
rate. When \code{n} is specified directly, no rounding occurs.}
}
\value{
A modified \code{sampling_design} object with selection parameters specified.
}
\description{
\code{draw()} specifies how units are selected: sample size, sampling fraction,
selection method, and measure of size for PPS sampling. Every stage in a
sampling design must end with \code{draw()}.
}
\details{
\subsection{Selection Methods}{
\subsection{Equal Probability Methods}{\tabular{llll}{
   Method \tab Replacement \tab Sample Size \tab Notes \cr
   \code{srswor} \tab Without \tab Fixed \tab Standard SRS \cr
   \code{srswr} \tab With \tab Fixed \tab Allows duplicates \cr
   \code{systematic} \tab Without \tab Fixed \tab Periodic selection \cr
   \code{bernoulli} \tab Without \tab Random \tab Each unit selected independently \cr
}

}

\subsection{PPS Methods}{\tabular{llll}{
   Method \tab Replacement \tab Sample Size \tab Notes \cr
   \code{pps_systematic} \tab Without \tab Fixed \tab Simple, some bias \cr
   \code{pps_brewer} \tab Without \tab Fixed \tab Fast, π_ij > 0 \cr
   \code{pps_maxent} \tab Without \tab Fixed \tab Highest entropy, π_ij available \cr
   \code{pps_poisson} \tab Without \tab Random \tab PPS analog of Bernoulli \cr
   \code{pps_multinomial} \tab With \tab Fixed \tab Allows duplicates \cr
}

}

}

\subsection{Parameter Requirements}{\tabular{llll}{
   Method \tab \code{n} \tab \code{frac} \tab \code{mos} \cr
   \code{srswor} \tab ✓ \tab or ✓ \tab — \cr
   \code{srswr} \tab ✓ \tab or ✓ \tab — \cr
   \code{systematic} \tab ✓ \tab or ✓ \tab — \cr
   \code{bernoulli} \tab — \tab ✓ \tab — \cr
   \code{pps_systematic} \tab ✓ \tab or ✓ \tab ✓ \cr
   \code{pps_brewer} \tab ✓ \tab or ✓ \tab ✓ \cr
   \code{pps_maxent} \tab ✓ \tab — \tab ✓ \cr
   \code{pps_poisson} \tab — \tab ✓ \tab ✓ \cr
   \code{pps_multinomial} \tab ✓ \tab or ✓ \tab ✓ \cr
}

}

\subsection{Fixed vs Random Sample Size Methods}{

Methods with \strong{fixed sample size} (\code{srswor}, \code{srswr}, \code{systematic}, \code{pps_systematic},
\code{pps_brewer}, \code{pps_maxent}, \code{pps_multinomial}) accept either \code{n} or \code{frac}. When \code{frac}
is provided, the sample size is computed based on the \code{round} parameter (default: ceiling).

Methods with \strong{random sample size} (\code{bernoulli}, \code{pps_poisson}) require \code{frac} only.
These methods perform independent selection trials for each unit, so the final sample
size is a random variable—not a fixed count. Specifying \code{n} would be misleading since
the method cannot guarantee exactly \code{n} selections.
}

\subsection{Custom Allocation with Data Frames}{

For stratum-specific sample sizes or rates, pass a data frame to \code{n} or \code{frac}.
The data frame must contain:
\itemize{
\item All stratification variable columns (matching those in \code{stratify_by()})
\item An \code{n} column (for sizes) or \code{frac} column (for rates)
}
}
}
\examples{
# Simple random sample of 100 facilities
sampling_design() |>
  draw(n = 100) |>
  execute(kenya_health, seed = 1)

# Systematic sample of 10\%
sampling_design() |>
  draw(frac = 0.10, method = "systematic") |>
  execute(kenya_health, seed = 123)

# PPS sample of schools using enrollment
sampling_design() |>
  cluster_by(school_id) |>
  draw(n = 50, method = "pps_brewer", mos = enrollment) |>
  execute(tanzania_schools, seed = 42)

# Bernoulli sampling (random sample size, expected ~5\%)
sampling_design() |>
  draw(frac = 0.05, method = "bernoulli") |>
  execute(nigeria_business, seed = 1234)

# Stratified with different sizes per stratum (data frame)
facility_sizes <- data.frame(
  facility_type = c("Clinic", "Dispensary", "Health Centre",
                    "Sub-County Hospital", "County Hospital",
                    "Referral Hospital", "Maternity Home"),
  n = c(30, 40, 35, 25, 20, 10, 15)
)
sampling_design() |>
  stratify_by(facility_type) |>
  draw(n = facility_sizes) |>
  execute(kenya_health, seed = 123)

# Stratified with different rates per stratum (named vector)
sampling_design() |>
  stratify_by(size_class) |>
  draw(frac = c(Micro = 0.01, Small = 0.05, Medium = 0.20, Large = 0.50)) |>
  execute(nigeria_business, seed = 42)

# Neyman allocation with minimum 2 per stratum (for variance estimation)
sampling_design() |>
  stratify_by(region, alloc = "neyman", variance = niger_eas_variance) |>
  draw(n = 150, min_n = 2) |>
  execute(niger_eas, seed = 2026)

# Proportional allocation with min and max bounds
sampling_design() |>
  stratify_by(region, alloc = "proportional") |>
  draw(n = 200, min_n = 10, max_n = 50) |>
  execute(niger_eas, seed = 42)

}
\seealso{
\code{\link[=sampling_design]{sampling_design()}} for creating designs,
\code{\link[=stratify_by]{stratify_by()}} for stratification,
\code{\link[=cluster_by]{cluster_by()}} for clustering,
\code{\link[=execute]{execute()}} for running designs
}
